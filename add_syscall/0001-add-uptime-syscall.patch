From 79ab95c67b2f6d40a83c8d7c7bc09f27f4b5484a Mon Sep 17 00:00:00 2001
From: inso <thomas.moussajee@gmail.com>
Date: Fri, 16 Oct 2015 10:45:26 -0700
Subject: [PATCH] add uptime syscall

Signed-off-by: inso <thomas.moussajee@gmail.com>
---
 arch/x86/entry/syscalls/syscall_64.tbl |  1 +
 kernel/sys.c                           | 18 ++++++++++++++++++
 2 files changed, 19 insertions(+)

diff --git a/arch/x86/entry/syscalls/syscall_64.tbl b/arch/x86/entry/syscalls/syscall_64.tbl
index 278842f..a240fdb 100644
--- a/arch/x86/entry/syscalls/syscall_64.tbl
+++ b/arch/x86/entry/syscalls/syscall_64.tbl
@@ -331,6 +331,7 @@
 322	64	execveat		stub_execveat
 323	common	userfaultfd		sys_userfaultfd
 324	common	membarrier		sys_membarrier
+325	common	uptime			sys_uptime
 
 #
 # x32-specific system call numbers start at 512 to avoid cache impact
diff --git a/kernel/sys.c b/kernel/sys.c
index fa2f2f6..0e2fc19 100644
--- a/kernel/sys.c
+++ b/kernel/sys.c
@@ -2429,3 +2429,21 @@ COMPAT_SYSCALL_DEFINE1(sysinfo, struct compat_sysinfo __user *, info)
 	return 0;
 }
 #endif /* CONFIG_COMPAT */
+
+SYSCALL_DEFINE1(uptime, time_t*, t)
+{
+	struct sysinfo data;
+	int ret;
+	time_t time;
+
+	ret = do_sysinfo(&data);
+
+	if (!ret) {
+		time = data.uptime;
+		ret = copy_to_user(t, &time, sizeof(*t)) ? -EFAULT : 0;
+		}
+
+	if (ret)
+		time = ((time_t) -1);
+	return time;
+}
-- 
2.1.4

